.TH apport\-chroot 1 "August 11, 2007" "Martin Pitt"

.SH NAME

apport\-chroot \- Create and use chroots for apport retracing

.SH SYNOPSIS

.B apport\-chroot 
[
.I options
]
.B create
.I release chrootpath

.B apport\-chroot 
[
.I options
]
.B retrace
.I crashid
.br
.B apport\-chroot 
[
.I options
]
.B retrace
.I reportfile

.B apport\-chroot 
[
.I options
]
.B upgrade
.I chroot
.br
.B apport\-chroot 
[
.I options
]
.B upgrade all

.B apport\-chroot 
[
.I options
]
.B installdeb
.I chroot debpath
[
.I debpath ...
]

.B apport\-chroot 
[
.I options
]
.B login
.I chroot

.SH DESCRIPTION

.SS Introduction

.B apport\-chroot
is a tool to create, update, and manage chroots for using
.B apport\-retrace
for several distributions and releases without needing to touch the
installed system at all. It uses fakeroot and fakechroot, so that the
entire reprocessing of apport reports which get submitted to the crash
database can happen on a system where you do not have any root
privileges or special packages installed.

Chroots can either be kept as a normal directory, or be stored as a
compressed tarball. In the latter case, the tarballs are temporarily
unpacked when using them. While unpacking takes a certain amount of
time, this is well compensated by not having to purge packages after
installing them for retracing, and being sure not to destroy the
chroot on failed upgrades, buggy maintainer scripts, etc. This also
allows you to use a chroot for several tasks in parallel.

.SS Installation

If fakeroot or fakechroot themselves are not installed, you can just
put the libraries anywhere and set the environment variables
.B APPORT_LIBFAKEROOT
and
.B APPORT_LIBFAKECHROOT
to the full path of
.B libfakeroot.so
and
.B libfakechroot.so\fR. If the distribution packages are installed,
they will be found and used automatically.

.SS Creating chroots

The
.B create
mode is mostly a wrapper around
.B debootstrap
which does the grunt work of actually creating a basic chroot.
.B apport\-chroot
then does some additional modifications:

.IP * 4
Install some additional packages like
.B apport-retrace
and
.B gpgv
(as well as extra packages specified with
.B \-p\fR)

.IP * 4
Optionally set up additional apt sources (with
.B \-a\fR)

.IP * 4
Adapt the apt
.B sources.list
if you use a file:// mirror

.IP * 4
Disable daemons with a
.B policy\-rc.d

.IP * 4
Clean up the apt package cache

.PP
The only two required arguments are the release name (passed to
debootstrap), and the target path (a directory, or the path to a
.B .tar.gz
tarball). For the reasons stated above, you usually want to supply
.B \-\-tar
and some additional apt sources with
.B \-a\fR.

.SS Using chroots for retracing

In
.B retrace
mode, apport\-chroot selects and prepares a chroot for the crash to
reprocess and calls
.B apport\-retrace
in the chroot with the crash file. Most of the options regarding
retracing are passed to apport\-retrace, with making sure to properly
handle file references by symlinking them into the chroot.

In this mode you need to specify a "chroot map" which maps
distribution names and release versions to chroot paths. Please see
the documentation of
.B \-m\fR/\fB\-\-chroot\-map
below for details.

If you want to enable duplicate checking, you need to specify the path
to the duplicate database. Please see
.B \-\-duplicate\-db
below for details.

.SS Maintaining chroots

The most common maintenance operation is
.B upgrade
which takes a chroot path as argument, or a DistroRelease: name if a
chroot map is specified. If
.B all
is specified as chroot name, all chroots in the chroot map are
upgraded.

To install a set of externally provided .deb packages into the chroot,
you can use the
.B installdeb
mode. This will temporarily copy the debs into the chroot and install
them with dpkg.

The
.B login
mode will provide a shell in the chroot which can be used for general
maintenance. If you use tarball chroots, you need to decide whether
you want to keep the changes after logging out (specify
.B \-\-save\fR) or throw them away (default).

In 
.B \-\-save
mode, you can still throw away the changes if you log out with a
nonzero exit code, i. e. by doing
.B exit 1\fR.

.SH OPTIONS

.TP
.B \-\-mirror=\fIURL	
Use an alternate archive mirror (passed to
.B debootstrap\fR). 

This is only relevant in
.B create
mode. (Passed to
.B debootstrap\fR)

.TP
.B \-p \fIpackage\fR, \fB\-\-extra\-package=\fIpackage
Install an additional package for the selected operation. May be
specified multiple times.

This is only relevant in
.B create
mode.

.TP
.B \-a \fIsource\fR, \fB\-\-apt\-source=\fIsource
Add an extra apt source when creating chroots. May be specified
multiple times.

This is only relevant in
.B create
mode.

.TP
.B \-t\fR, \fB\-\-tar
Create a chroot tarball instead of a permanent directory.

This is only relevant in
.B create
mode, for other operations you can specify a directory or a tarball.

.TP
.B \-\-save
When logging in to a chroot tarball, update the tarball afterwards to
save modifications if the shell exits with status 0.

This is only relevant in
.B login
mode if the chroot is a tarball.

.TP
.B \-m \fIMAP\fR, \fB\-\-chroot\-map=\fIMAP

Path to chroot map. This file maps DistroRelease: values to chroot
paths (in the syntax of a Python dictionary). This needs to be
specified when refering to a chroot by distro release name instead of
a chroot path, or when using
.B apport\-chroot
in
.B retrace
mode and specifying a crash ID. In the latter case, the
.B DistroRelease: 
field is first read from the crash database, and the appropriate
chroot selected from that map. Example:

.IP
{
    "Ubuntu 7.04": "chroots/feisty.tar.gz",
    "Debian 3.1": "chroots/sarge.tar.gz",
.br
}

.TP
.B \-v, \-\-verbose
Verbose operation. This option is also passed to
.B apport\-retrace
to report download/install progress when installing additional
packages.

.TP
.B \-\-auth=\fIauthfile
If a bug number is given without any of the options
.B \-g\fR,
.B \-s\fR, or
.B \-o\fR,
then the retraced stack traces are attached to the bug.
Since this needs authentication, an authentication file for the crash
database must be specified. This could e. g. be the standard
.B cookies.txt
from Firefox' profile directory if the crash database uses
cookie based authentication. This option is passed to
.B apport\-retrace
(after copying the file into the chroot).

.TP
.B \-\-duplicate\-db=\fIdbfile
Specify path to the duplicate check database (in SQLite format). The
database will be created and initialized if it does not exist. This
option is passed to
.B apport\-retrace
(after linking the file into the chroot).

If not specified,
.B apport\-retrace
will not check for duplicates.

.TP
.B \-\-confirm\-attach
Display retraced stack traces and ask for confirmation before
uploading them to the bug report. This option is ignored when
retracing report files. This option is just passed to
.B apport-retrace\fR.

.TP
.B \-h, \-\-help
Print a short online help that documents all options.

.SH AUTHOR
.B apport
and the accompanying tools are developed by Martin Pitt
<martin.pitt@ubuntu.com>.
