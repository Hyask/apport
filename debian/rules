#!/usr/bin/make -f

DEB_PYTHON_SYSTEM := pycentral
export DH_PYCENTRAL := $(shell if dpkg --compare-versions `dpkg-query -W -f '$${Version}' python-central` gt 0.6.11; then echo include-links; else echo nomove; fi)

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/python-distutils.mk
include /usr/share/cdbs/1/rules/langpack.mk

DEB_DH_INSTALL_SOURCEDIR := debian/tmp
ifneq (,$(findstring 2.6,$(shell python --version 2>&1)))
DEB_PYTHON_INSTALL_ARGS_ALL := --no-compile --install-scripts usr/share/apport --install-layout=deb
else
DEB_PYTHON_INSTALL_ARGS_ALL := --no-compile --install-scripts usr/share/apport
endif

binary-install/apport::
	# upstream already installs init script
	dh_installinit -p $(cdbs_curpkg) --onlyscripts

	# ignore wine crashes by default, until we found a way to
	# handle them appropriately
	install -d debian/$(cdbs_curpkg)/etc/apport/blacklist.d
	echo '/usr/bin/wine-preloader' > debian/$(cdbs_curpkg)/etc/apport/blacklist.d/apport

clean::
	# remove backend copies
	rm -f apport/packaging_impl.py
